<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MP+</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap" rel="stylesheet">
  <style>
    /* your styles (same as you already have) */
    *{box-sizing:border-box;margin:0;padding:0;font-family:'Orbitron',sans-serif}
    body{height:100vh;background:linear-gradient(135deg,#0f0c29,#302b63,#24243e);display:flex;justify-content:center;align-items:center;color:#fff;overflow:hidden}
    .container{background:rgba(0,0,0,0.7);padding:40px;border-radius:20px;text-align:center;box-shadow:0 0 40px #00fff7,0 0 80px #ff00ff;animation:pulse 2s infinite alternate;width:100%;max-width:450px}
    @keyframes pulse{0%{box-shadow:0 0 40px #00fff7,0 0 80px #ff00ff}100%{box-shadow:0 0 60px #00fff7,0 0 120px #ff00ff}}
    .logo{width:80px;margin-bottom:20px}
    h1{font-size:2rem;margin-bottom:20px;text-shadow:0 0 10px #00fff7,0 0 20px #ff00ff}
    h2{font-size:1.5rem;margin-bottom:25px}
    .branding{display:flex;align-items:center;justify-content:center;gap:10px;margin-bottom:20px}
    .branding h1{color:#00fff7;text-shadow:0 0 10px #00fff7,0 0 20px #ff00ff}
    input[type="url"]{width:100%;padding:15px;border-radius:10px;border:none;outline:none;font-size:1rem;margin-bottom:20px;background:rgba(255,255,255,0.1);color:#fff;box-shadow:inset 0 0 10px #00fff7,inset 0 0 20px #ff00ff;transition:all .3s ease}
    input[type="url"]:focus{box-shadow:inset 0 0 15px #00fff7,inset 0 0 30px #ff00ff;background:rgba(255,255,255,0.2)}
    button{padding:15px 40px;border-radius:10px;border:none;background:linear-gradient(90deg,#00fff7,#ff00ff);color:#000;font-size:1.2rem;font-weight:bold;cursor:pointer;transition:all .3s ease;text-shadow:0 0 5px #fff}
    button:hover{transform:scale(1.05);box-shadow:0 0 20px #00fff7,0 0 40px #ff00ff}
    .msg{margin-top:12px;padding:10px;border-radius:8px;font-weight:700;display:none;box-shadow:0 0 10px #00fff7,0 0 20px #ff00ff}
  </style>
</head>
<body>
  <div class="container">
    <div class="branding">
      <img src="logo.png" alt="MP+ Logo" class="logo">
      <h1>MP+</h1>
    </div>
    <h2>Enter Your Class's Maths Pathway URL</h2>
    <form id="urlForm" autocomplete="off">
      <input type="url" id="mpUrl" placeholder="https://yourclass.mpclass.com" required>
      <button type="submit">Enter Class</button>
      <div id="msg" class="msg" role="status" aria-live="polite"></div>
    </form>
  </div>

  <script>
    (async () => {
      const urlForm = document.getElementById('urlForm');
      const input = document.getElementById('mpUrl');
      const msg = document.getElementById('msg');

      // helper to show message
      function showMsg(text, color = '#00fff7') {
        msg.style.display = 'block';
        msg.style.color = color;
        msg.textContent = text;
      }
      function hideMsg() { msg.style.display = 'none'; msg.textContent = ''; }

      // Try to load saved URL from main
      try {
        if (window.mpplus && window.mpplus.loadUrl) {
          const resp = await window.mpplus.loadUrl();
          if (resp && resp.ok && resp.url) {
            // open saved URL directly
            await window.mpplus.openUrl(resp.url);
            return; // done
          }
        } else {
          console.warn('mpplus API not available in renderer');
        }
      } catch (err) {
        console.error('Error loading saved url', err);
      }

      urlForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        e.stopPropagation();
        hideMsg();

        let url = input.value.trim();

        // Strict validation: https://*.mpclass.com or https://*.mpclass.com/
        const regex = /^https:\/\/([a-zA-Z0-9-]+\.)?mpclass\.com(\/.*)?$/;
        if (!regex.test(url)) {
          showMsg('Invalid URL! Must be https://*.mpclass.com', '#ff0044');
          input.focus();
          return;
        }

        // Normalize: remove anything after the domain root so trailing paths are stripped
        url = url.replace(/(https:\/\/([a-zA-Z0-9-]+\.)?mpclass\.com).*/, '$1');

        try {
          if (window.mpplus && window.mpplus.saveUrl) {
            const saveResp = await window.mpplus.saveUrl(url);
            if (!saveResp || !saveResp.ok) {
              showMsg('Failed to save URL locally', '#ff0044');
              console.error('save-url failed', saveResp);
              return;
            }
          } else {
            console.warn('mpplus.saveUrl not available — skipping local save');
          }

          // Ask main to open the URL in the main BrowserWindow
          if (window.mpplus && window.mpplus.openUrl) {
            const openResp = await window.mpplus.openUrl(url);
            if (!openResp || !openResp.ok) {
              showMsg('Failed to open URL in app', '#ff0044');
              console.error('open-url failed', openResp);
              return;
            }
          } else {
            // Fallback: navigate the renderer (may work but is less ideal)
            window.location.href = url;
          }
        } catch (err) {
          console.error('Submit error', err);
          showMsg('Unexpected error — check DevTools', '#ff0044');
        }
      });
    })();
  </script>
</body>
</html>